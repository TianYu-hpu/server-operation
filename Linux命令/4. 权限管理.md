# 权限管理
## ACL 权限
### 简介与开启方式
所有者 所属组 其他人用不到特别复杂的权限管理，比如一个老师 (owner) 开了一个课程，学生们 (grouper) 可以读取或修改老师上传的课件内容 (rwx), 其他任何人对这个目录没有读写执行的权限，这个时候来了一个试听的学员，那么该怎么分配权限呢，传统的 所有者，所属组， 其他人已经不能满足这种权限分配了，因此需要引入 ACL 权限管理。要使用 ACL 权限首先需要分区支持 ACL 权限，首先查看分区是否开启 ACL 权限。

	dumpe2fs -h /dev/sda3
dumpe2fs 命令是查询指定分区详细文件系统信息的命令  
选项:  
-h 仅显示超级块中信息，而不显示磁盘块组的详细信息 
在显示的信息里面找 default mount options 关键字，看是否有 acl 这样的字样，则说明是支持 ACL 选项，默认是支持的，如果不支持也可以设置让它临时开启分区 ACL 权限

	#重新挂载根分区，并挂载加入 acl 权限
	mount -o remount,acl /
永久生效的话，修改 /etc/fstab 文件，在UUID 后面的 defaults 后面加入 acl 选项，然后重新执行命令

	# 重新挂载文件系统或重启系统，使修改生效
	mount -o remount  
### 查看和设定 ACL 权限

	# 查看 ACL 权限
	getfacl 文件名

	# 设定 ACL 权限
	setfacl 选项 文件名
	选项:
	-m 设定 acl 权限
	-x 删除指定的 acl 权限
	-b 删除所有的 acl 权限
	-d 设定默认的 acl 权限
	-k 删除默认的 acl 权限
	-R 递归设定 acl 权限

	# 给用户 st 设定 /project 读和执行的权限
	setfacl -m u:st:rx /project
	选项:
	u 表示为用户分配 ACL 权限，后面跟用户名
	g 表示为group 分配 ACL 权限，后面跟组名

	使用ls -l格式查看这个目录的时候会发现所有者、所属组、其它人的权限表示后面多了一个 + 表示这个文件夹具有 ACL 权限。
### 最大有效权限和删除 ACL 权限
getfacl 显示信息的后面会有一个 mask 的标记，这是用来指定最大的有效权限的，如果我给用户赋予了 ACL 权限，是需要和 mask 的权限 “相与” 才能得到用户的真正权限。

	# 设定 /project 最大有效权限为 rx
	setfacl -m m:rx /project  

	# 删除 acl 权限
	# 删除组的 ACl 权限
	setfacl -x g:tgroup /project
	# 删除所有权限
	setfacl -b /project
### 默认 ACL 权限和递归 ACL 权限

	# 设定 /project 目录下的用户 acl 权限为 rx 权限
	setfacl -m d:u:st:rx  /project

	# 设定递归权限
	setfacl -m u:st:rx -R /project
## 文件特殊权限
SetUID  
1. 只有可执行的二进制程序才能设定 SUID 权限  
2. 命令执行者要对该程序拥有 x 权限  
3. 命令执行者在执行该程序的时候获得该程序文件属主的身份(在执行程序的过程中灵魂附体为文件的属主)  
4. SetUID 权限只在该程序执行过程中有效，也就是说身份改变只在执行过程中有效  
例子:查询 /usr/bin/passwd 的权限分配发现原本是 x 权限的位置变成了 s,这里的 s 就代表 SetUID 的意思    
设定 SetUID 的方法  
 4 代表 SUID  
	
	# 添加权限
	chmod 4755 文件名
	chmod u+s 文件名

	# 取消权限
	chmod 755 文件名
	chmod u-s 文件名
  
 2 代表 SGID  
 1 代表 SBIT  
SetGID  
针对文件的作用  
1. 只有可执行的二进制程序才能设定 SUID 权限  
2. 命令执行者要对该程序拥有 x 权限  
3. 命令执行者在执行该程序的时候，组身份升级为该程序文件的属组  
4. SetGID 权限只在该程序执行过程中有效，也就是说组身份改变只在执行过程中有效 
locate 命令具有 SGID 权限是的组内的其他用户在执行的时候也具有查看 /var/lib/mlocate/mlocate.db 权限   
针对目录的作用  
1. 普通用户必须对此目录拥有 rx 权限，才能进入此目录  
2. 普通用户在此目录中的有效组会变成此目录的属组  
3. 若普通用户对此目录拥有 w 权限时，新建的文件的默认属组是这个目录的属组    
Sticky BIT  
1. 粘着位目前只对目录有效  
2. 普通用户对该目录拥有 wx 权限  
3. 如果没有粘着位，因为普通用户拥有 w 权限，所以可以删除此目录下的所有文件，包括其他用户u建立的文件，一旦赋予了粘着位，除了 root 可以删除所有文件， 普通用户就算有 w 权限， 也只能够删除自己建立的文件，但是不能删除其他用户建立的文件。  
例子 /tmp 目录，tmp 目录权限为 777 权限，任何用户都可以在里面创建文件，但是其它用户不能删除别的用户建立的文件。除了 root 用户 ，在 tmp 目录长格式显示情况下可以看到 t 表示粘着位目录  
## 文件系统属性 chattr 权限
### 设置文件系统属性

	chattr [+-=] [选项] 文件或目录名
	+:增加权限
	-:删除权限
	=:等于某权限
	选项:
	-i：如果对文件设置 i 属性，那么不允许对文件进行删除、改名、也不能添加和修改数据；如果对目录设置 i 属性，那么只能修改目录下文件的数据，但不允许建立和删除文件。  
	a:如果对文件设置 a 属性，那么只能在文件中增加数据，但是不能删除也不能修改数据，如果对目录设置 a 属性，那么只允许在目录中建立和修改文件，但是不允许删除。
	
### 查看文件系统属性  

	lsattr 选项 文件名
	-a 显示所有文件和目录
	-d 若目标是目录，仅列出目录本身的属性，而不是子文件的
	查询出来的内容后面加了一个 e 符号，表名这个文件系统是 ext 文件系统
## 系统命令 sudo 权限
sudo 操作对象时系统命令，让普通用户能执行超级用户执行的命令

visudo 给普通用户授权具有执行 sudo 命令的权限
例子:

	root 	ALL		=			(ALL) 				ALL
	用户名 	被管理主机的地址 	（可使用的身份） 	授权命令(绝对路径)
	%组名 